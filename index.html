<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qureo Auto Solver - Ù†Ø¸Ø§Ù… Ø§Ù„Ø¨Ø±ÙˆÙƒØ³ÙŠ Ø§Ù„Ø°ÙƒÙŠ</title>
    <style>
        :root {
            --bg-color: #0f172a;
            --card-bg: #1e293b;
            --primary: #3b82f6;
            --success: #10b981;
            --error: #ef4444;
            --text: #f8fafc;
            --text-muted: #94a3b8;
            --warning: #f59e0b;
            --purple: #8b5cf6;
            --cyan: #06b6d4;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text);
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            background-color: var(--card-bg);
            padding: 2rem;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
            width: 100%;
            max-width: 900px;
        }

        h1 {
            margin-bottom: 1rem;
            color: var(--primary);
            font-size: 1.8rem;
            text-align: center;
        }

        h2 {
            color: var(--warning);
            margin: 1rem 0;
            font-size: 1.3rem;
        }

        h3 {
            color: var(--cyan);
            margin: 0.5rem 0;
            font-size: 1.1rem;
        }

        .input-group {
            margin-bottom: 1rem;
            text-align: right;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        input, select, textarea, button {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #334155;
            background-color: #0f172a;
            color: white;
            font-size: 1rem;
            box-sizing: border-box;
            outline: none;
            transition: 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            border-color: var(--primary);
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
            margin: 5px;
            text-align: center;
        }

        .btn-block {
            width: 100%;
            display: block;
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background-color: #2563eb;
        }

        .btn-success {
            background-color: var(--success);
            color: white;
        }

        .btn-success:hover {
            background-color: #0da271;
        }

        .btn-warning {
            background-color: var(--warning);
            color: white;
        }

        .btn-warning:hover {
            background-color: #d97706;
        }

        .btn-danger {
            background-color: var(--error);
            color: white;
        }

        .btn-danger:hover {
            background-color: #dc2626;
        }

        .btn-purple {
            background-color: var(--purple);
            color: white;
        }

        .btn-purple:hover {
            background-color: #7c3aed;
        }

        /* Tabs */
        .tabs {
            display: flex;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid #334155;
            flex-wrap: wrap;
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            color: var(--text-muted);
            border-bottom: 2px solid transparent;
            transition: 0.3s;
            flex: 1;
            text-align: center;
            min-width: 120px;
        }

        .tab.active {
            color: var(--primary);
            border-bottom: 2px solid var(--primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Proxy Stats */
        .proxy-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .stat-box {
            background: #0f172a;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid #334155;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-good { color: var(--success); }
        .stat-bad { color: var(--error); }
        .stat-warn { color: var(--warning); }
        .stat-info { color: var(--primary); }

        .stat-label {
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        /* Proxy List */
        .proxy-list-container {
            max-height: 300px;
            overflow-y: auto;
            margin: 15px 0;
            padding: 10px;
            background: #0f172a;
            border-radius: 8px;
            border: 1px solid #334155;
        }

        .proxy-item {
            padding: 8px;
            margin: 4px 0;
            background: #1e293b;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-family: monospace;
            font-size: 0.9rem;
        }

        .proxy-item:hover {
            background: #334155;
        }

        .proxy-status {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-left: 10px;
        }

        .status-good { background: var(--success); }
        .status-bad { background: var(--error); }
        .status-checking { background: var(--warning); animation: pulse 1s infinite; }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        /* Progress Bars */
        .progress-container {
            width: 100%;
            height: 8px;
            background: #334155;
            border-radius: 4px;
            margin: 10px 0;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--success));
            transition: width 0.3s;
            border-radius: 4px;
        }

        /* Control Panel */
        .control-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .control-card {
            background: #0f172a;
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #334155;
            text-align: center;
        }

        /* Logs */
        .logs-container {
            margin-top: 20px;
            background-color: #0f172a;
            border-radius: 8px;
            padding: 15px;
            height: 250px;
            overflow-y: auto;
            border: 1px solid #334155;
        }

        .log-entry {
            margin-bottom: 6px;
            padding-bottom: 6px;
            border-bottom: 1px solid #1e293b;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            line-height: 1.4;
        }

        .log-time {
            color: var(--text-muted);
            font-size: 0.75rem;
        }

        .log-success { color: var(--success); }
        .log-error { color: var(--error); }
        .log-warning { color: var(--warning); }
        .log-info { color: var(--text-muted); }
        .log-proxy { color: var(--purple); }
        .log-debug { color: var(--cyan); }

        /* Connection Status */
        .connection-status {
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
            display: inline-block;
            margin-bottom: 15px;
        }

        .status-connected { 
            background: rgba(16, 185, 129, 0.2); 
            color: var(--success); 
            border: 1px solid var(--success); 
        }
        .status-disconnected { 
            background: rgba(239, 68, 68, 0.2); 
            color: var(--error); 
            border: 1px solid var(--error); 
        }
        .status-checking { 
            background: rgba(245, 158, 11, 0.2); 
            color: var(--warning); 
            border: 1px solid var(--warning); 
        }

        /* Loading */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(59, 130, 246, 0.3);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s ease-in-out infinite;
            vertical-align: middle;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .hidden { display: none; }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }

        /* Responsive */
        @media (max-width: 768px) {
            .proxy-stats {
                grid-template-columns: repeat(2, 1fr);
            }
            .control-panel {
                grid-template-columns: 1fr;
            }
            .tab {
                min-width: 100px;
                padding: 8px 12px;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>ğŸ›¡ï¸ Qureo Solver - Ù†Ø¸Ø§Ù… Ø§Ù„Ø¨Ø±ÙˆÙƒØ³ÙŠ Ø§Ù„Ø°ÙƒÙŠ</h1>
        
        <div class="tabs">
            <div class="tab active" onclick="switchTab('proxy')">ğŸ§ª Ù†Ø¸Ø§Ù… Ø§Ù„Ø¨Ø±ÙˆÙƒØ³ÙŠ</div>
            <div class="tab" onclick="switchTab('solver')">ğŸ¤– Ø­Ù„ Ø§Ù„Ø¯Ø±ÙˆØ³</div>
            <div class="tab" onclick="switchTab('settings')">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</div>
        </div>

        <!-- Proxy Tab -->
        <div id="proxyTab" class="tab-content active">
            <div class="connection-status" id="connectionStatus">
                <span>ğŸ”´ ØºÙŠØ± Ù…ØªØµÙ„</span>
            </div>

            <div class="proxy-stats">
                <div class="stat-box">
                    <div class="stat-value stat-info" id="totalProxies">0</div>
                    <div class="stat-label">Ø§Ù„Ø¨Ø±ÙˆÙƒØ³ÙŠØ§Øª Ø§Ù„Ù…Ø¬Ù…Ø¹Ø©</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value stat-good" id="workingProxies">0</div>
                    <div class="stat-label">Ø§Ù„Ø¨Ø±ÙˆÙƒØ³ÙŠØ§Øª Ø§Ù„Ù†Ø´Ø·Ø©</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value stat-bad" id="deadProxies">0</div>
                    <div class="stat-label">Ø§Ù„Ø¨Ø±ÙˆÙƒØ³ÙŠØ§Øª Ø§Ù„ÙØ§Ø´Ù„Ø©</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value stat-warn" id="currentSpeed">0ms</div>
                    <div class="stat-label">Ø³Ø±Ø¹Ø© Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©</div>
                </div>
            </div>

            <div class="progress-container">
                <div class="progress-bar" id="proxyProgress" style="width: 0%"></div>
            </div>

            <div class="control-panel">
                <div class="control-card">
                    <h3>ğŸ”„ Ø¬Ù…Ø¹ Ø§Ù„Ø¨Ø±ÙˆÙƒØ³ÙŠØ§Øª</h3>
                    <p>Ø¬Ù…Ø¹ Ø¨Ø±ÙˆÙƒØ³ÙŠØ§Øª Ù…Ù† Ù…ØµØ§Ø¯Ø± Ù…ØªØ¹Ø¯Ø¯Ø©</p>
                    <button class="btn btn-primary btn-block" onclick="fetchProxies()" id="fetchBtn">
                        Ø¨Ø¯Ø¡ Ø§Ù„Ø¬Ù…Ø¹
                    </button>
                </div>
                
                <div class="control-card">
                    <h3>âœ… ÙØ­Øµ Ø§Ù„Ø¨Ø±ÙˆÙƒØ³ÙŠØ§Øª</h3>
                    <p>ÙØ­Øµ ÙˆØªØµÙÙŠØ© Ø§Ù„Ø¨Ø±ÙˆÙƒØ³ÙŠØ§Øª Ø§Ù„Ù†Ø´Ø·Ø©</p>
                    <button class="btn btn-success btn-block" onclick="checkProxies()" id="checkBtn">
                        Ø¨Ø¯Ø¡ Ø§Ù„ÙØ­Øµ
                    </button>
                </div>
                
                <div class="control-card">
                    <h3>âš¡ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„</h3>
                    <p>Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¨Ø±ÙˆÙƒØ³ÙŠ Ø§Ù„Ø£Ø³Ø±Ø¹</p>
                    <button class="btn btn-warning btn-block" onclick="testFastestProxy()" id="testBtn">
                        Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø³Ø±Ø¹Ø©
                    </button>
                </div>
                
                <div class="control-card">
                    <h3>ğŸš€ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„</h3>
                    <p>Ø¨Ø¯Ø¡ Ø­Ù„ Ø§Ù„Ø¯Ø±ÙˆØ³ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø£ÙØ¶Ù„ Ø¨Ø±ÙˆÙƒØ³ÙŠ</p>
                    <button class="btn btn-purple btn-block" onclick="startSolving()" id="startBtn">
                        Ø¨Ø¯Ø¡ Ø§Ù„Ø­Ù„
                    </button>
                </div>
            </div>

            <div style="margin: 20px 0;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <h3>ğŸ“‹ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¨Ø±ÙˆÙƒØ³ÙŠØ§Øª Ø§Ù„Ù†Ø´Ø·Ø©</h3>
                    <div>
                        <button class="btn btn-danger" onclick="clearProxies()" style="padding: 5px 10px; font-size: 0.8rem;">
                            ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
                        </button>
                    </div>
                </div>
                
                <div class="proxy-list-container" id="proxyList">
                    <div class="proxy-item">
                        <span>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span>
                        <span class="proxy-status status-checking"></span>
                    </div>
                </div>
            </div>

            <div class="logs-container" id="proxyLogs">
                <div class="log-entry log-info">
                    <span class="log-time">[00:00:00]</span>
                    ğŸš€ Ù†Ø¸Ø§Ù… Ø§Ù„Ø¨Ø±ÙˆÙƒØ³ÙŠ Ø§Ù„Ø°ÙƒÙŠ Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¹Ù…Ù„
                </div>
            </div>
        </div>

        <!-- Solver Tab -->
        <div id="solverTab" class="tab-content">
            <div id="loginSection">
                <h2>ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
                <div class="input-group">
                    <label>Ø±Ù‚Ù… Ø§Ù„Ø·Ø§Ù„Ø¨ (Student ID)</label>
                    <input type="text" id="studentId" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ù‡Ù†Ø§">
                </div>
                <div class="input-group">
                    <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± (Password)</label>
                    <input type="password" id="password" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
                </div>
                <div class="input-group">
                    <label>Ø§Ù„Ù‚Ø³Ù… (Section ID)</label>
                    <input type="number" id="sectionId" value="5" min="1" max="10">
                </div>
                <button class="btn btn-success btn-block" onclick="loginToQureo()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
            </div>

            <div id="solverSection" class="hidden">
                <h2>ğŸ“š Ø­Ù„ Ø§Ù„Ø¯Ø±ÙˆØ³</h2>
                <div style="margin: 20px 0;">
                    <button class="btn btn-primary" onclick="getLessons()">ğŸ”„ Ø¬Ù„Ø¨ Ø§Ù„Ø¯Ø±ÙˆØ³</button>
                    <button class="btn btn-success" onclick="solveAll()">âš¡ Ø­Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¯Ø±ÙˆØ³</button>
                    <button class="btn btn-warning" onclick="solveSelected()">ğŸ¯ Ø­Ù„ Ù…Ø­Ø¯Ø¯</button>
                </div>

                <div class="proxy-list-container" id="lessonsList">
                    <div class="proxy-item">
                        <span>Ù‚Ù… Ø¨ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹</span>
                    </div>
                </div>

                <div style="margin-top: 20px;">
                    <h3>ğŸ“Š ØªÙ‚Ø¯Ù… Ø§Ù„Ø­Ù„</h3>
                    <div class="progress-container">
                        <div class="progress-bar" id="solvingProgress" style="width: 0%"></div>
                    </div>
                    <div style="text-align: center; margin-top: 10px;">
                        <span id="progressText">0/0 Ø¯Ø±ÙˆØ³</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Tab -->
        <div id="settingsTab" class="tab-content">
            <h2>âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</h2>
            
            <div class="input-group">
                <label>Ø¹Ø¯Ø¯ Ø«ÙˆØ§Ù†ÙŠ Ø§Ù„Ù…Ù‡Ù„Ø© (Timeout)</label>
                <input type="number" id="timeout" value="10" min="1" max="30">
            </div>

            <div class="input-group">
                <label>Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ø§Ù„ Ø§Ù„Ù…ØªØ²Ø§Ù…Ù†ÙŠÙ† (Workers)</label>
                <input type="number" id="workers" value="50" min="1" max="200">
            </div>

            <div class="input-group">
                <label>Ù…ØµØ§Ø¯Ø± Ø§Ù„Ø¨Ø±ÙˆÙƒØ³ÙŠØ§Øª (URLs Ù…ÙØµÙˆÙ„Ø© Ø¨ÙÙˆØ§ØµÙ„)</label>
                <textarea id="proxySources" rows="6">https://api.proxyscrape.com/v2/?request=getproxies&protocol=http&timeout=10000&country=all&ssl=all
https://raw.githubusercontent.com/TheSpeedX/SOCKS-List/master/http.txt
https://raw.githubusercontent.com/monosans/proxy-list/main/proxies/http.txt
https://raw.githubusercontent.com/jetkai/proxy-list/main/online-proxies/txt/proxies-http.txt
https://raw.githubusercontent.com/roosterkid/openproxylist/main/HTTPS_RAW.txt
https://raw.githubusercontent.com/mmpx12/proxy-list/master/http.txt
https://raw.githubusercontent.com/ShiftyTR/Proxy-List/master/http.txt</textarea>
            </div>

            <div class="input-group">
                <label><input type="checkbox" id="autoFetch" checked> Ø¬Ù…Ø¹ Ø¨Ø±ÙˆÙƒØ³ÙŠØ§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ Ø§Ù„Ø¨Ø¯Ø¡</label>
            </div>

            <div class="input-group">
                <label><input type="checkbox" id="autoCheck" checked> ÙØ­Øµ Ø¨Ø±ÙˆÙƒØ³ÙŠØ§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¨Ø¹Ø¯ Ø§Ù„Ø¬Ù…Ø¹</label>
            </div>

            <div class="input-group">
                <label><input type="checkbox" id="autoRotate" checked> ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø¨Ø±ÙˆÙƒØ³ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ Ø§Ù„ÙØ´Ù„</label>
            </div>

            <div style="margin-top: 20px;">
                <button class="btn btn-primary" onclick="saveSettings()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
                <button class="btn btn-warning" onclick="resetSettings()">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†</button>
            </div>
        </div>
    </div>

    <script>
        // ================= Configuration =================
        const QUREO_BASE = "https://me-tp.qureo.education";
        const QUREO_PORTAL = "https://me-portal.qureo.education";
        
        // Global state
        let proxyManager = {
            allProxies: [],
            workingProxies: [],
            deadProxies: [],
            currentProxy: null,
            isRunning: false,
            isLoggedIn: false,
            stats: {
                totalFetched: 0,
                working: 0,
                dead: 0,
                speed: 0
            }
        };

        // ================= Initialization =================
        function init() {
            loadSettings();
            updateStats();
            loadWorkingProxies();
            log("ğŸš€ Ù†Ø¸Ø§Ù… Ø§Ù„Ø¨Ø±ÙˆÙƒØ³ÙŠ Ø§Ù„Ø°ÙƒÙŠ Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¹Ù…Ù„", "info");
            
            // Auto-fetch if enabled
            if (getSetting('autoFetch', true)) {
                setTimeout(() => {
                    fetchProxies();
                }, 1000);
            }
        }

        // ================= Proxy Fetching =================
        async function fetchProxies() {
            if (proxyManager.isRunning) return;
            
            proxyManager.isRunning = true;
            const fetchBtn = document.getElementById('fetchBtn');
            fetchBtn.innerHTML = '<span class="loading"></span> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¬Ù…Ø¹...';
            fetchBtn.disabled = true;
            
            log("ğŸ”„ Ø¨Ø¯Ø¡ Ø¬Ù…Ø¹ Ø§Ù„Ø¨Ø±ÙˆÙƒØ³ÙŠØ§Øª Ù…Ù† Ø§Ù„Ù…ØµØ§Ø¯Ø±...", "proxy");
            
            const sources = document.getElementById('proxySources').value.split('\n').filter(s => s.trim());
            proxyManager.allProxies = [];
            
            try {
                for (const source of sources) {
                    if (!proxyManager.isRunning) break;
                    
                    log(`ğŸ“¥ Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ù…Ù†: ${source.split('/')[2] || source}`, "debug");
                    
                    try {
                        const response = await fetch(`https://corsproxy.io/?${encodeURIComponent(source)}`, {
                            timeout: getSetting('timeout', 10) * 1000
                        }).catch(() => null);
                        
                        if (response && response.ok) {
                            const text = await response.text();
                            const proxies = text.split('\n')
                                .map(p => p.trim())
                                .filter(p => p && !p.includes(':') && p.length > 6);
                            
                            proxyManager.allProxies.push(...proxies);
                            log(`âœ… ØªÙ… Ø¬Ù„Ø¨ ${proxies.length} Ø¨Ø±ÙˆÙƒØ³ÙŠ Ù…Ù† Ø§Ù„Ù…ØµØ¯Ø±`, "success");
                        }
                    } catch (e) {
                        log(`âŒ ÙØ´Ù„ Ø¬Ù„Ø¨ Ù…Ù†: ${source}`, "error");
                    }
                }
                
                // Remove duplicates
                proxyManager.allProxies = [...new Set(proxyManager.allProxies)];
                proxyManager.stats.totalFetched = proxyManager.allProxies.length;
                
                log(`ğŸ‰ ØªÙ… Ø¬Ù…Ø¹ ${proxyManager.allProxies.length} Ø¨Ø±ÙˆÙƒØ³ÙŠ ÙØ±ÙŠØ¯`, "success");
                updateStats();
                
                // Auto-check if enabled
                if (getSetting('autoCheck', true) && proxyManager.allProxies.length > 0) {
                    setTimeout(() => {
                        checkProxies();
                    }, 1000);
                }
                
            } catch (e) {
                log(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø¬Ù…Ø¹ Ø§Ù„Ø¨Ø±ÙˆÙƒØ³ÙŠØ§Øª: ${e.message}`, "error");
            } finally {
                proxyManager.isRunning = false;
                fetchBtn.innerHTML = 'Ø¨Ø¯Ø¡ Ø§Ù„Ø¬Ù…Ø¹';
                fetchBtn.disabled = false;
            }
        }

        // ================= Proxy Checking =================
        async function checkProxies() {
            if (proxyManager.isRunning || proxyManager.allProxies.length === 0) {
                if (proxyManager.allProxies.length === 0) {
                    log("âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨Ø±ÙˆÙƒØ³ÙŠØ§Øª Ù„Ù„ÙØ­Øµ. Ù‚Ù… Ø¨Ø§Ù„Ø¬Ù…Ø¹ Ø£ÙˆÙ„Ø§Ù‹", "warning");
                }
                return;
            }
            
            proxyManager.isRunning = true;
            const checkBtn = document.getElementById('checkBtn');
            checkBtn.innerHTML = '<span class="loading"></span> Ø¬Ø§Ø±ÙŠ Ø§Ù„ÙØ­Øµ...';
            checkBtn.disabled = true;
            
            proxyManager.workingProxies = [];
            proxyManager.deadProxies = [];
            
            const total = proxyManager.allProxies.length;
            const workers = getSetting('workers', 50);
            const batchSize = Math.ceil(total / workers);
            
            log(`ğŸ” Ø¨Ø¯Ø¡ ÙØ­Øµ ${total} Ø¨Ø±ÙˆÙƒØ³ÙŠ Ø¨Ù€ ${workers} Ø¹Ø§Ù…Ù„ Ù…ØªØ²Ø§Ù…Ù†...`, "proxy");
            
            // Clear proxy list display
            const proxyListEl = document.getElementById('proxyList');
            proxyListEl.innerHTML = '';
            
            // Create batches
            const batches = [];
            for (let i = 0; i < total; i += batchSize) {
                batches.push(proxyManager.allProxies.slice(i, i + batchSize));
            }
            
            // Process batches
            for (let batchIndex = 0; batchIndex < batches.length; batchIndex++) {
                if (!proxyManager.isRunning) break;
                
                const batch = batches[batchIndex];
                const promises = batch.map(proxy => checkSingleProxy(proxy));
                
                await Promise.all(promises);
                
                // Update progress
                const progress = ((batchIndex + 1) / batches.length) * 100;
                document.getElementById('proxyProgress').style.width = `${progress}%`;
                
                updateStats();
                updateProxyList();
            }
            
            // Save working proxies
            saveWorkingProxies();
            
            log(`âœ… ØªÙ… Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ Ù…Ù† Ø§Ù„ÙØ­Øµ: ${proxyManager.workingProxies.length} Ù†Ø§Ø¬Ø­ØŒ ${proxyManager.deadProxies.length} ÙØ§Ø´Ù„`, "success");
            
            proxyManager.isRunning = false;
            checkBtn.innerHTML = 'Ø¨Ø¯Ø¡ Ø§Ù„ÙØ­Øµ';
            checkBtn.disabled = false;
            document.getElementById('proxyProgress').style.width = '100%';
            
            // Test fastest proxy
            if (proxyManager.workingProxies.length > 0) {
                setTimeout(() => {
                    testFastestProxy();
                }, 500);
            }
        }
        
        async function checkSingleProxy(proxy) {
            const testUrl = `https://corsproxy.io/?${encodeURIComponent(QUREO_PORTAL)}`;
            
            try {
                // Create controller for timeout
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), getSetting('timeout', 10) * 1000);
                
                const startTime = Date.now();
                const response = await fetch(testUrl, {
                    signal: controller.signal,
                    headers: {
                        'X-Proxy': proxy
                    }
                }).catch(() => null);
                
                clearTimeout(timeoutId);
                
                if (response && response.ok) {
                    const speed = Date.now() - startTime;
                    proxyManager.workingProxies.push({ proxy, speed });
                    proxyManager.stats.working++;
                    
                    // Update fastest proxy
                    if (!proxyManager.currentProxy || speed < proxyManager.currentProxy.speed) {
                        proxyManager.currentProxy = { proxy, speed };
                        proxyManager.stats.speed = speed;
                    }
                    
                    return true;
                } else {
                    proxyManager.deadProxies.push(proxy);
                    proxyManager.stats.dead++;
                    return false;
                }
            } catch (e) {
                proxyManager.deadProxies.push(proxy);
                proxyManager.stats.dead++;
                return false;
            }
        }

        // ================= Fastest Proxy Test =================
        async function testFastestProxy() {
            if (proxyManager.workingProxies.length === 0) {
                log("âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨Ø±ÙˆÙƒØ³ÙŠØ§Øª Ù†Ø´Ø·Ø© Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±", "warning");
                return;
            }
            
            const testBtn = document.getElementById('testBtn');
            testBtn.innerHTML = '<span class="loading"></span> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±...';
            testBtn.disabled = true;
            
            log("âš¡ Ø§Ø®ØªØ¨Ø§Ø± Ø³Ø±Ø¹Ø© Ø§Ù„Ø¨Ø±ÙˆÙƒØ³ÙŠØ§Øª Ø§Ù„Ù†Ø´Ø·Ø©...", "proxy");
            
            // Sort by speed and take top 5
            const fastestProxies = [...proxyManager.workingProxies]
                .sort((a, b) => a.speed - b.speed)
                .slice(0, 5);
            
            // Test each proxy
            for (const proxyData of fastestProxies) {
                try {
                    const startTime = Date.now();
                    const response = await fetch(`https://corsproxy.io/?${encodeURIComponent(QUREO_PORTAL)}`, {
                        timeout: 5000,
                        headers: {
                            'X-Proxy': proxyData.proxy
                        }
                    }).catch(() => null);
                    
                    if (response && response.ok) {
                        const speed = Date.now() - startTime;
                        proxyData.speed = speed;
                        
                        if (!proxyManager.currentProxy || speed < proxyManager.currentProxy.speed) {
                            proxyManager.currentProxy = proxyData;
                            proxyManager.stats.speed = speed;
                            
                            log(`ğŸ† Ø£ÙØ¶Ù„ Ø¨Ø±ÙˆÙƒØ³ÙŠ: ${proxyData.proxy} - ${speed}ms`, "success");
                            updateConnectionStatus(true);
                        }
                    }
                } catch (e) {
                    // Skip this proxy
                }
            }
            
            updateStats();
            testBtn.innerHTML = 'Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø³Ø±Ø¹Ø©';
            testBtn.disabled = false;
        }

        // ================= Smart Fetch System =================
        async function smartFetch(url, options = {}) {
            if (!proxyManager.currentProxy) {
                log("âš ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨Ø±ÙˆÙƒØ³ÙŠ Ù†Ø´Ø·. Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«...", "warning");
                await testFastestProxy();
                
                if (!proxyManager.currentProxy) {
                    throw new Error('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨Ø±ÙˆÙƒØ³ÙŠØ§Øª Ù†Ø´Ø·Ø©');
                }
            }
            
            const proxy = proxyManager.currentProxy.proxy;
            const proxyUrl = `https://corsproxy.io/?${encodeURIComponent(url)}`;
            
            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), getSetting('timeout', 10) * 1000);
                
                const response = await fetch(proxyUrl, {
                    ...options,
                    signal: controller.signal,
                    headers: {
                        ...options.headers,
                        'X-Proxy': proxy
                    }
                });
                
                clearTimeout(timeoutId);
                
                if (response.ok) {
                    return response;
                } else if (response.status === 403 || response.status === 429) {
                    // Proxy blocked, try another one
                    log(`ğŸ”„ Ø§Ù„Ø¨Ø±ÙˆÙƒØ³ÙŠ ${proxy} Ù…Ø­Ø¸ÙˆØ±. Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ¨Ø¯ÙŠÙ„...`, "warning");
                    
                    // Remove current proxy
                    proxyManager.workingProxies = proxyManager.workingProxies.filter(p => p.proxy !== proxy);
                    proxyManager.currentProxy = null;
                    
                    // Try next fastest proxy
                    if (proxyManager.workingProxies.length > 0) {
                        proxyManager.workingProxies.sort((a, b) => a.speed - b.speed);
                        proxyManager.currentProxy = proxyManager.workingProxies[0];
                        return await smartFetch(url, options);
                    } else {
                        throw new Error('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨Ø±ÙˆÙƒØ³ÙŠØ§Øª Ù…ØªØ§Ø­Ø©');
                    }
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (e) {
                if (getSetting('autoRotate', true)) {
                    // Try another proxy
                    log(`ğŸ”„ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨Ø±ÙˆÙƒØ³ÙŠ ${proxy}. Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ¨Ø¯ÙŠÙ„...`, "warning");
                    
                    if (proxyManager.workingProxies.length > 1) {
                        proxyManager.workingProxies = proxyManager.workingProxies.filter(p => p.proxy !== proxy);
                        proxyManager.workingProxies.sort((a, b) => a.speed - b.speed);
                        proxyManager.currentProxy = proxyManager.workingProxies[0];
                        return await smartFetch(url, options);
                    }
                }
                
                throw e;
            }
        }

        // ================= Qureo Solver =================
        async function loginToQureo() {
            const studentId = document.getElementById('studentId').value;
            const password = document.getElementById('password').value;
            const sectionId = document.getElementById('sectionId').value;
            
            if (!studentId || !password) {
                log("ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„", "error");
                return;
            }
            
            log("ğŸ” Ø¬Ø§Ø±ÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ Qureo...", "info");
            
            try {
                const response = await smartFetch(`${QUREO_PORTAL}/oauth2/password-login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': '*/*'
                    },
                    body: JSON.stringify({ 
                        student_id: studentId, 
                        password: password 
                    })
                });
                
                if (response.ok) {
                    proxyManager.isLoggedIn = true;
                    
                    document.getElementById('loginSection').classList.add('hidden');
                    document.getElementById('solverSection').classList.remove('hidden');
                    
                    log("âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­!", "success");
                    await getLessons();
                } else {
                    log("âŒ ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„. ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª", "error");
                }
            } catch (e) {
                log(`âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„: ${e.message}`, "error");
            }
        }
        
        async function getLessons() {
            if (!proxyManager.isLoggedIn) return;
            
            log("ğŸ“š Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¯Ø±ÙˆØ³...", "info");
            
            try {
                const sectionId = document.getElementById('sectionId').value;
                const response = await smartFetch(`${QUREO_BASE}/api/study/students/sections/${sectionId}/chapters`);
                
                if (response.ok) {
                    const chapters = await response.json();
                    displayLessons(chapters);
                }
            } catch (e) {
                log(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¯Ø±ÙˆØ³: ${e.message}`, "error");
            }
        }
        
        function displayLessons(chapters) {
            const container = document.getElementById('lessonsList');
            container.innerHTML = '';
            
            chapters.forEach(chapter => {
                const chapterEl = document.createElement('div');
                chapterEl.className = 'proxy-item';
                chapterEl.innerHTML = `
                    <div style="flex: 1;">
                        <strong>${chapter.title || `Ø§Ù„ÙØµÙ„ ${chapter.chapter_number}`}</strong>
                        <div style="font-size: 0.8rem; color: #94a3b8;">
                            ${chapter.completed_at ? 'âœ… Ù…ÙƒØªÙ…Ù„' : 'â³ ØºÙŠØ± Ù…ÙƒØªÙ…Ù„'}
                        </div>
                    </div>
                    <button class="btn btn-success" style="padding: 3px 8px; font-size: 0.8rem;"
                            onclick="solveChapter('${chapter.chapter_id}')">
                        Ø­Ù„
                    </button>
                `;
                container.appendChild(chapterEl);
            });
        }
        
        async function solveAll() {
            log("âš¡ Ø¨Ø¯Ø¡ Ø­Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¯Ø±ÙˆØ³...", "info");
            // Implementation for solving all lessons
        }
        
        async function solveSelected() {
            // Implementation for solving selected lessons
        }
        
        async function solveChapter(chapterId) {
            log(`ğŸ” Ø¨Ø¯Ø¡ Ø­Ù„ Ø§Ù„ÙØµÙ„ ${chapterId}...`, "info");
            // Implementation for solving a chapter
        }

        // ================= UI Updates =================
        function updateStats() {
            document.getElementById('totalProxies').textContent = proxyManager.allProxies.length;
            document.getElementById('workingProxies').textContent = proxyManager.workingProxies.length;
            document.getElementById('deadProxies').textContent = proxyManager.deadProxies.length;
            document.getElementById('currentSpeed').textContent = proxyManager.currentProxy ? 
                `${proxyManager.currentProxy.speed}ms` : '0ms';
        }
        
        function updateProxyList() {
            const container = document.getElementById('proxyList');
            const topProxies = proxyManager.workingProxies
                .sort((a, b) => a.speed - b.speed)
                .slice(0, 20);
            
            container.innerHTML = '';
            
            if (topProxies.length === 0) {
                container.innerHTML = '<div class="proxy-item">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨Ø±ÙˆÙƒØ³ÙŠØ§Øª Ù†Ø´Ø·Ø©</div>';
                return;
            }
            
            topProxies.forEach(proxyData => {
                const item = document.createElement('div');
                item.className = 'proxy-item';
                item.innerHTML = `
                    <span>${proxyData.proxy}</span>
                    <div>
                        <span style="color: ${proxyData.speed < 1000 ? '#10b981' : '#f59e0b'}; margin-right: 10px;">
                            ${proxyData.speed}ms
                        </span>
                        <span class="proxy-status ${proxyData.proxy === (proxyManager.currentProxy?.proxy) ? 'status-good' : 'status-checking'}"></span>
                    </div>
                `;
                container.appendChild(item);
            });
        }
        
        function updateConnectionStatus(connected = false) {
            const statusEl = document.getElementById('connectionStatus');
            if (connected && proxyManager.currentProxy) {
                statusEl.innerHTML = `ğŸŸ¢ Ù…ØªØµÙ„ - ${proxyManager.currentProxy.proxy.split(':')[0]}`;
                statusEl.className = 'connection-status status-connected';
            } else {
                statusEl.innerHTML = 'ğŸ”´ ØºÙŠØ± Ù…ØªØµÙ„';
                statusEl.className = 'connection-status status-disconnected';
            }
        }
        
        function log(message, type = 'info') {
            const container = document.getElementById('proxyLogs');
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            
            const time = new Date().toLocaleTimeString('en-US', {hour12: false});
            entry.innerHTML = `<span class="log-time">[${time}]</span> ${message}`;
            
            container.prepend(entry);
            
            // Keep logs manageable
            if (container.children.length > 50) {
                container.removeChild(container.lastChild);
            }
            
            // Also log to console
            console.log(`[${type}] ${message}`);
        }

        // ================= Settings Management =================
        function loadSettings() {
            const settings = JSON.parse(localStorage.getItem('proxySettings') || '{}');
            
            document.getElementById('timeout').value = settings.timeout || 10;
            document.getElementById('workers').value = settings.workers || 50;
            document.getElementById('proxySources').value = settings.proxySources || document.getElementById('proxySources').value;
            document.getElementById('autoFetch').checked = settings.autoFetch !== false;
            document.getElementById('autoCheck').checked = settings.autoCheck !== false;
            document.getElementById('autoRotate').checked = settings.autoRotate !== false;
        }
        
        function saveSettings() {
            const settings = {
                timeout: parseInt(document.getElementById('timeout').value),
                workers: parseInt(document.getElementById('workers').value),
                proxySources: document.getElementById('proxySources').value,
                autoFetch: document.getElementById('autoFetch').checked,
                autoCheck: document.getElementById('autoCheck').checked,
                autoRotate: document.getElementById('autoRotate').checked
            };
            
            localStorage.setItem('proxySettings', JSON.stringify(settings));
            log("âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª", "success");
        }
        
        function resetSettings() {
            localStorage.removeItem('proxySettings');
            loadSettings();
            log("ğŸ”„ ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª", "info");
        }
        
        function getSetting(key, defaultValue) {
            const settings = JSON.parse(localStorage.getItem('proxySettings') || '{}');
            return settings[key] !== undefined ? settings[key] : defaultValue;
        }

        // ================= Utility Functions =================
        function clearProxies() {
            proxyManager.workingProxies = [];
            proxyManager.deadProxies = [];
            proxyManager.currentProxy = null;
            updateStats();
            updateProxyList();
            log("ğŸ—‘ï¸ ØªÙ… Ù…Ø³Ø­ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¨Ø±ÙˆÙƒØ³ÙŠØ§Øª", "info");
        }
        
        function saveWorkingProxies() {
            const proxies = proxyManager.workingProxies.map(p => `${p.proxy}|${p.speed}`);
            localStorage.setItem('workingProxies', JSON.stringify(proxies));
        }
        
        function loadWorkingProxies() {
            try {
                const saved = JSON.parse(localStorage.getItem('workingProxies') || '[]');
                proxyManager.workingProxies = saved.map(item => {
                    const [proxy, speed] = item.split('|');
                    return { proxy, speed: parseInt(speed) };
                });
                
                if (proxyManager.workingProxies.length > 0) {
                    proxyManager.workingProxies.sort((a, b) => a.speed - b.speed);
                    proxyManager.currentProxy = proxyManager.workingProxies[0];
                    proxyManager.stats.speed = proxyManager.currentProxy.speed;
                    updateConnectionStatus(true);
                }
                
                updateStats();
                updateProxyList();
            } catch (e) {
                console.error('Error loading proxies:', e);
            }
        }
        
        function startSolving() {
            if (!proxyManager.currentProxy) {
                log("âš ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨Ø±ÙˆÙƒØ³ÙŠ Ù†Ø´Ø·. Ù‚Ù… Ø¨Ø¬Ù…Ø¹ ÙˆÙØ­Øµ Ø§Ù„Ø¨Ø±ÙˆÙƒØ³ÙŠØ§Øª Ø£ÙˆÙ„Ø§Ù‹", "warning");
                return;
            }
            
            switchTab('solver');
            log("ğŸš€ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø­Ù„ Ø§Ù„Ø¯Ø±ÙˆØ³...", "success");
        }

        // ================= Tab Management =================
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(tabName + 'Tab').classList.add('active');
            event.target.classList.add('active');
        }

        // ================= Initialize =================
        window.addEventListener('load', init);
        
    </script>
</body>
</html>
